{"ast":null,"code":"import _asyncToGenerator from\"C:/DaoWebsite/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/DaoWebsite/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\DaoWebsite\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";// eslint-disable-next-line\nimport React,{useEffect,useState,getStatus}from\"react\";import\"./pages.css\";import{TabList,Tab,Widget,Tag,Table,Form}from\"web3uikit\";import{Link}from\"react-router-dom\";import{useMoralis,useMoralisWeb3Api,useWeb3ExecuteFunction}from\"react-moralis\";// eslint-disable-next-line\nimport{Moralis}from\"moralis\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Home=function Home(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),passRate=_useState2[0],setPassRate=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),totalP=_useState4[0],setTotalP=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),counted=_useState6[0],setCounted=_useState6[1];var _useMoralis=useMoralis(),Moralis=_useMoralis.Moralis,isInitialized=_useMoralis.isInitialized;var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),proposals=_useState8[0],setProposals=_useState8[1];var Web3Api=useMoralisWeb3Api();var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),voters=_useState10[0],setVoters=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),sub=_useState12[0],setSub=_useState12[1];var contractProcessor=useWeb3ExecuteFunction();function createProposal(_x){return _createProposal.apply(this,arguments);}function _createProposal(){_createProposal=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(newProposal){var options;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:options={contractAddress:\"0xAEEAfcA812D0f122006da84E2ADDFa17c1A1f035\",functionName:\"createProposal\",abi:[{inputs:[{internalType:\"string\",name:\"_description\",type:\"string\"},{internalType:\"address[]\",name:\"_canVote\",type:\"address[]\"}],name:\"createProposal\",outputs:[],stateMutability:\"nonpayable\",type:\"function\"}],params:{_description:newProposal,_canVote:voters}};_context5.next=3;return contractProcessor.fetch({params:options,onSuccess:function onSuccess(){console.log(\"Proposal Succesful\");setSub(false);},onError:function onError(error){alert(error.data.message);setSub(false);}});case 3:case\"end\":return _context5.stop();}}},_callee5);}));return _createProposal.apply(this,arguments);}function getStatus(_x2){return _getStatus.apply(this,arguments);}function _getStatus(){_getStatus=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(proposalId){var ProposalCounts,query,result;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:ProposalCounts=Moralis.Object.extend(\"ProposalCounts\");query=new Moralis.Query(ProposalCounts);query.equalTo(\"uid\",proposalId);_context6.next=5;return query.first();case 5:result=_context6.sent;if(!(result!==undefined)){_context6.next=14;break;}if(!result.attributes.passed){_context6.next=11;break;}return _context6.abrupt(\"return\",{color:\"green\",text:\"Passed\"});case 11:return _context6.abrupt(\"return\",{color:\"red\",text:\"Rejected\"});case 12:_context6.next=15;break;case 14:return _context6.abrupt(\"return\",{color:\"yellow\",text:\"Ongoing\"});case 15:case\"end\":return _context6.stop();}}},_callee6);}));return _getStatus.apply(this,arguments);}useEffect(function(){if(isInitialized){var getProposals=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var Proposals,query,results,table;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:Proposals=Moralis.Object.extend(\"Proposals\");query=new Moralis.Query(Proposals);query.descending(\"uid_decimal\");_context2.next=5;return query.find();case 5:results=_context2.sent;_context2.next=8;return Promise.all(results.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=e.attributes.uid;_context.t1=e.attributes.description;_context.t2=_jsx;_context.t3=Link;_context.t4=e.attributes.description;_context.next=7;return getStatus(e.attributes.uid);case 7:_context.t5=_context.sent.color;_context.next=10;return getStatus(e.attributes.uid);case 10:_context.t6=_context.sent.text;_context.t7=e.attributes.uid;_context.t8=e.attributes.proposer;_context.t9={description:_context.t4,color:_context.t5,text:_context.t6,id:_context.t7,proposer:_context.t8};_context.t10=_jsx;_context.t11=Tag;_context.next=18;return getStatus(e.attributes.uid);case 18:_context.t12=_context.sent.color;_context.next=21;return getStatus(e.attributes.uid);case 21:_context.t13=_context.sent.text;_context.t14={color:_context.t12,text:_context.t13};_context.t15=(0,_context.t10)(_context.t11,_context.t14);_context.t16={to:\"/proposal\",state:_context.t9,children:_context.t15};_context.t17=(0,_context.t2)(_context.t3,_context.t16);return _context.abrupt(\"return\",[_context.t0,_context.t1,_context.t17]);case 27:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref2.apply(this,arguments);};}()));case 8:table=_context2.sent;setProposals(table);setTotalP(results.length);case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getProposals(){return _ref.apply(this,arguments);};}();var getPassRate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var ProposalCounts,query,results,votesUp;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:ProposalCounts=Moralis.Object.extend(\"ProposalCounts\");query=new Moralis.Query(ProposalCounts);_context3.next=4;return query.find();case 4:results=_context3.sent;votesUp=0;results.forEach(function(e){if(e.attributes.passed){votesUp++;}});setCounted(results.length);setPassRate(votesUp/results.length*100);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function getPassRate(){return _ref3.apply(this,arguments);};}();var fetchTokenIdOwners=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var options,tokenIdOwners,addresses;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:options={address:\"0x2953399124F0cBB46d2CbACD8A89cF0599974963\",token_id:\"50518411100313848705589140712404998518682214475431081288604171428342498590721\",chain:\"mumbai\"};_context4.next=3;return Web3Api.token.getTokenIdOwners(options);case 3:tokenIdOwners=_context4.sent;addresses=tokenIdOwners.result.map(function(e){return e.owner_of;});setVoters(addresses);case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function fetchTokenIdOwners(){return _ref4.apply(this,arguments);};}();fetchTokenIdOwners();getProposals();getPassRate();}// eslint-disable-next-line\n},[isInitialized]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:/*#__PURE__*/_jsxs(TabList,{defaultActiveKey:1,tabStyle:\"bulbUnion\",children:[/*#__PURE__*/_jsx(Tab,{tabKey:1,tabName:\"DAO\",children:proposals&&/*#__PURE__*/_jsxs(\"div\",{className:\"tabContent\",children:[\"Governance Overview\",/*#__PURE__*/_jsxs(\"div\",{className:\"widgets\",children:[/*#__PURE__*/_jsx(Widget,{info:totalP,title:\"Proposals\",style:{width:\"200%\"}//here's the prob\n,children:/*#__PURE__*/_jsxs(\"div\",{className:\"extraWidgetInfo\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"extraTitle\",children:\"Pass Rate\"}),/*#__PURE__*/_jsx(\"div\",{className:\"progress\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progressPercentage\",style:{width:\"\".concat(passRate,\"%\")}})})]})}),/*#__PURE__*/_jsx(Widget,{info:voters.length,title:\"Eligible Voters\",style:{width:\"100%\"}}),/*#__PURE__*/_jsx(Widget,{info:totalP-counted,title:\"Ongoing Proposals\",style:{width:\"100%\"}})]}),\"Recent Proposals\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:\"30px\"},children:/*#__PURE__*/_jsx(Table,{columnsConfig:\"10% 70% 17%\",data:proposals,header:[/*#__PURE__*/_jsx(\"span\",{children:\"ID\"}),/*#__PURE__*/ //not aligned\n_jsx(\"span\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Status\"})],pageSize:5})}),/*#__PURE__*/_jsx(Form,{buttonConfig:{isLoading:sub,loadingText:\"Submitting Proposal\",text:\"Submit\",theme:\"secondary\"},data:[{inputWidth:\"100%\",name:\"New Proposal\",type:\"textarea\",validation:{required:true},value:\"\"}],onSubmit:function onSubmit(e){setSub(true);createProposal(e.data[0].inputResult);},title:\"Create a New Proposal\"})]})}),/*#__PURE__*/_jsx(Tab,{tabKey:2,tabName:\"Forum\"}),/*#__PURE__*/_jsx(Tab,{tabKey:3,tabName:\"Docs\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"voting\"})]});};export default Home;","map":{"version":3,"sources":["C:/DaoWebsite/src/pages/Home.js"],"names":["React","useEffect","useState","getStatus","TabList","Tab","Widget","Tag","Table","Form","Link","useMoralis","useMoralisWeb3Api","useWeb3ExecuteFunction","Moralis","Home","passRate","setPassRate","totalP","setTotalP","counted","setCounted","isInitialized","proposals","setProposals","Web3Api","voters","setVoters","sub","setSub","contractProcessor","createProposal","newProposal","options","contractAddress","functionName","abi","inputs","internalType","name","type","outputs","stateMutability","params","_description","_canVote","fetch","onSuccess","console","log","onError","error","alert","data","message","proposalId","ProposalCounts","Object","extend","query","Query","equalTo","first","result","undefined","attributes","passed","color","text","getProposals","Proposals","descending","find","results","Promise","all","map","e","uid","description","proposer","id","table","length","getPassRate","votesUp","forEach","fetchTokenIdOwners","address","token_id","chain","token","getTokenIdOwners","tokenIdOwners","addresses","owner_of","width","marginTop","isLoading","loadingText","theme","inputWidth","validation","required","value","inputResult"],"mappings":"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","sourcesContent":["// eslint-disable-next-line\r\nimport React, { useEffect, useState, getStatus } from \"react\";\r\nimport \"./pages.css\";\r\nimport { TabList, Tab, Widget, Tag, Table, Form } from \"web3uikit\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useMoralis, useMoralisWeb3Api, useWeb3ExecuteFunction } from \"react-moralis\";\r\n\r\n// eslint-disable-next-line\r\nimport {Moralis} from \"moralis\";\r\n\r\n\r\nconst Home = () => {\r\n \r\n  const [passRate, setPassRate] = useState(0);\r\n  const [totalP, setTotalP] = useState(0);\r\n  const [counted, setCounted] = useState(0);\r\n  const { Moralis, isInitialized } = useMoralis();\r\n  const [proposals, setProposals] = useState();\r\n  const Web3Api = useMoralisWeb3Api();\r\n  const [voters, setVoters] = useState(0);\r\n  const [sub, setSub] = useState();\r\n  const contractProcessor = useWeb3ExecuteFunction();\r\n\r\n  async function createProposal(newProposal){\r\n    let options = {\r\n      contractAddress: \"0xAEEAfcA812D0f122006da84E2ADDFa17c1A1f035\",\r\n      functionName: \"createProposal\",\r\n      abi: [\r\n       \r\n        {\r\n          inputs:[\r\n            {\r\n              internalType:\"string\",\r\n              name:\"_description\",\r\n              type:\"string\"\r\n            },\r\n            {\r\n              internalType:\"address[]\",\r\n              name:\"_canVote\",\r\n              type:\"address[]\"\r\n            }\r\n          ],\r\n          name:\"createProposal\",\r\n          outputs:[],\r\n          stateMutability:\"nonpayable\",\r\n          type:\"function\"\r\n        }\r\n      ],\r\n      params: {\r\n        _description: newProposal,\r\n        _canVote: voters,\r\n      },\r\n    };\r\n    \r\n    await contractProcessor.fetch({\r\n      params: options,\r\n      onSuccess: () => {\r\n        console.log(\"Proposal Succesful\");\r\n        setSub(false);\r\n      },\r\n      onError: (error) => {\r\n        alert(error.data.message);\r\n        setSub(false);\r\n      },\r\n    });\r\n  }\r\n\r\n  async function getStatus(proposalId) {\r\n    const ProposalCounts = Moralis.Object.extend(\"ProposalCounts\");\r\n    const query = new Moralis.Query(ProposalCounts);\r\n    query.equalTo(\"uid\", proposalId);\r\n    const result = await query.first();\r\n    if (result !== undefined){\r\n      if (result.attributes.passed) {\r\n        return { color: \"green\", text: \"Passed\" };\r\n      } else{\r\n        return { color: \"red\", text: \"Rejected\" };\r\n      }\r\n    } else {\r\n      return { color:\"yellow\", text:\"Ongoing\" };\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if(isInitialized) {\r\n      async function getProposals(){\r\n        const Proposals = Moralis.Object.extend(\"Proposals\");\r\n        const query = new Moralis.Query(Proposals);\r\n        query.descending(\"uid_decimal\");\r\n        const results = await query.find();\r\n        const table = await Promise.all(\r\n          results.map(async (e) => [\r\n            e.attributes.uid,\r\n            e.attributes.description,\r\n            <Link to=\"/proposal\" state={{\r\n              description: e.attributes.description,\r\n              color: (await getStatus(e.attributes.uid)).color,\r\n              text: (await getStatus(e.attributes.uid)).text,\r\n              id: e.attributes.uid,\r\n              proposer: e.attributes.proposer\r\n            }}>\r\n              <Tag\r\n                color={(await getStatus(e.attributes.uid)).color}\r\n                text={(await getStatus(e.attributes.uid)).text}\r\n              />\r\n            </Link>,\r\n          ])\r\n        );\r\n        setProposals(table);\r\n        setTotalP(results.length);\r\n      }\r\n\r\n      async function getPassRate(){\r\n        const ProposalCounts = Moralis.Object.extend(\"ProposalCounts\");\r\n        const query = new Moralis.Query(ProposalCounts);\r\n        const results = await query.find();\r\n        let votesUp = 0;\r\n\r\n        results.forEach((e) => {\r\n          if(e.attributes.passed){\r\n            votesUp++;\r\n          }\r\n        });\r\n\r\n        setCounted(results.length);\r\n        setPassRate((votesUp/results.length)*100);\r\n\r\n      }\r\n\r\n      const fetchTokenIdOwners = async () => {\r\n        const options = {\r\n          address: \"0x2953399124F0cBB46d2CbACD8A89cF0599974963\",\r\n          token_id:\r\n            \"50518411100313848705589140712404998518682214475431081288604171428342498590721\",\r\n          chain: \"mumbai\",\r\n        };\r\n        const tokenIdOwners = await Web3Api.token.getTokenIdOwners(options);\r\n        const addresses = tokenIdOwners.result.map((e) => e.owner_of);\r\n        setVoters(addresses);\r\n      };\r\n\r\n      fetchTokenIdOwners();\r\n      getProposals(); \r\n      getPassRate();\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [isInitialized]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"content\">\r\n      <TabList defaultActiveKey={1} tabStyle=\"bulbUnion\">\r\n        <Tab tabKey={1} tabName=\"DAO\">\r\n        {proposals && (\r\n        <div className=\"tabContent\">\r\n          Governance Overview\r\n          <div className=\"widgets\">\r\n            <Widget\r\n              info={totalP}\r\n              title=\"Proposals\"\r\n              style={{ width: \"200%\" }} //here's the prob\r\n            >\r\n              <div className=\"extraWidgetInfo\">\r\n                <div className=\"extraTitle\">Pass Rate</div>\r\n                <div className=\"progress\">\r\n                  <div\r\n                    className=\"progressPercentage\"\r\n                    style={{ width: `${passRate}%` }}\r\n                  ></div>\r\n                </div>\r\n              </div>\r\n            </Widget>\r\n            <Widget info={voters.length} title=\"Eligible Voters\"  style={{ width: \"100%\" }}/>\r\n            <Widget info={totalP-counted} title=\"Ongoing Proposals\" style={{ width: \"100%\" }}/>\r\n          </div>\r\n          Recent Proposals\r\n            <div style={{ marginTop: \"30px\" }}>\r\n              <Table \r\n                \r\n                columnsConfig=\"10% 70% 17%\"\r\n                data={proposals}\r\n                header={[\r\n                  <span>ID</span>, //not aligned\r\n                  <span>Description</span>,\r\n                  <span>Status</span>\r\n                ]}\r\n                pageSize={5}\r\n              ></Table>\r\n            </div>\r\n\r\n            <Form \r\n              buttonConfig={{\r\n                isLoading: sub,\r\n                loadingText: \"Submitting Proposal\",\r\n                text: \"Submit\",\r\n                theme: \"secondary\",\r\n              }}\r\n              data={[\r\n                {\r\n                  inputWidth: \"100%\",\r\n                  name: \"New Proposal\",\r\n                  type: \"textarea\",\r\n                  validation: {\r\n                    required: true,\r\n                  },\r\n                  value: \"\",\r\n                },\r\n              ]}\r\n              onSubmit={(e) =>{\r\n                setSub(true);\r\n                createProposal(e.data[0].inputResult);\r\n              }}\r\n              title=\"Create a New Proposal\"\r\n            />\r\n        </div>\r\n        )}\r\n        </Tab>\r\n        <Tab tabKey={2} tabName=\"Forum\"></Tab>\r\n        <Tab tabKey={3} tabName=\"Docs\"></Tab>\r\n      </TabList>\r\n      </div>\r\n      {/* somehow doesnt stay white */}\r\n      <div className=\"voting\"></div> \r\n    </>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}